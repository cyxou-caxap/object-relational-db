# Объектно-реляционная база данных
## Цель работы
Моделирование структуры базы данных (далее БД), использование операторов языка SQL для работы с
данными БД, применение хранимых процедур и триггеров.

## Задание
1. Спроектировать концептуальную модель предметной области (ER-диаграмму).

2. Создать физическую модель базы данных, находящуюся в третьей нормальной форме. Расписать ссылочную целостность БД.

3. Создать базу данных с разработанной физической моделью.

4. Выполнить вставку тестовых данных в таблицы. Привести пример использования операторов update, delete и merge.

5. Реализовать запросы.

6. Создать в БД хранимые процедуры, реализующие:
   - вставку с пополнением справочников;
   - удаление с очисткой справочников – удаление всех зависимых данных;
   - каскадное удаление;
   - вычисление и возврат значения агрегатной функции;
   - формирование статистики во временной таблице.

8. Реализовать триггеры для всех событий (insert,delete,update) до и после.

---
## Выполнение работы
Мной были спроектированы концептуальная и физическая модели для следующей предметной области:

**Охраняемые парковки**: адрес парковки, машина, владелец, место, рег. номер машины, дата и время заезда, дата и время выезда 

Запросы:
а. все парковки, расположенные на улицах, в названии которых есть слово «Малая», но на него название не заканчивается 
б. владелец машины, у которого несколько машин разных марок 
в. улица, на которой нет парковок 
г. парковка, открывающаяся позже всех 
д. владелец машины, останавливавшийся на парковках, количество которых больше среднего 
е. машина, которая стояла на всех парковках Центрального района 
ж. владелец, не парковавшийся на Вознесенском проспекте, но парковавшийся в Московском районе 

**Концептуальная модель:**

![Концептуальная модель](model_diagrams/conceptual_diagram.png "Концептуальная модель")

**Физическая модель:**

![Физическая модель](model_diagrams/physical_diagram.png "Физическая модель")

**Таблица ссылочной целостности**

| Внешний ключ | Родительская таблица | Как поддерживается ссылочная целостность при удалении | Как поддерживается ссылочная целостность при обновлении | Обоснование |
| ---:         |         ------:      |                        ------:                        |                          ------:                        | ---:        |
|  idBrand |  Brand | Ограничивается | Ограничивается |  Машина не может не иметь бренд даже при закрытии компании. Данные бренда могут измениться из-за его обновления, при этом у машин, выпущенных до обновления, будет котироваться старое название бренда. |
|  idCar |  Car | Каскадируется | Каскадируется | У владельца может не стать машины после ее продажи/аварии, поэтому и данные о ней также удалятся. Данные о машине могут измениться при смене регистрационного номера. |
|  idOwner |  Owner | Каскадируется | Каскадируется | Владелец может продать автомобиль или попасть в серьёзную аварию, поэтому и данные о нем могут быть удалены. Данные о владельце могут быть обновлены при смене ФИО. |
|  idCar |  Car | Каскадируется | Каскадируется | При удалении машины данные о ней также удаляются, соответственно парковочное место становится пустым. Данные о машине могут быть обновлены. |
|  idParking |  Parking | Каскадируется | Каскадируется | При закрытии парковки все парковочные места исчезают. Данные  о парковке могут быть обновлены. |
|  idStreet |  Street | Ограничивается | Каскадируется | Удалить можно только улицу, на которой нет парковок, так как парковка не может существовать без адреса. Данные об улице могут быть обновлены. |
|  idDistrict |  District | Ограничивается | Каскадируется | Удалить можно только район, на котором нет парковок, так как парковка не может существовать без адреса. Данные о районе могут быть обновлены. |


Создание и заполнение базы данных представлено в файлах [create_tables.sql](create_tables.sql) и [insert_data.sql](insert_data.sql).

Запросы реализованы в файле [queries.sql](queries.sql).

Хранимые процедуры выполнены в файле [stored_procedures.sql](stored_procedures.sql).

Файл [triggers.sql](triggers.sql) содержит триггеры.

---
